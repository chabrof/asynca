!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var s in i)("object"==typeof exports?exports:e)[s]=i[s]}}(window,function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);class s{init(){this._items&&(this._prefixLog="asynca : ",this._history=[],this._itemIdxToCacheIdx=[])}async _cache(e){let t,i,s,r;if(this._history.length>=this.cache.length){let h=this.unallocStrategie(e);t=this._history[h].itemIdx,i=this._history[h].cacheIdx,console.log(this._prefixLog,` get cacheIdx to recycle : ${i}  => free item : ${t}`),this.cache[i]=void 0,this._itemIdxToCacheIdx[t]=void 0,this._history.splice(h,1),r=this.free(t),s=i}else s=this._history.length;return this._history.push({itemIdx:e,cacheIdx:s}),this.cache[s]=this._items[e],this._itemIdxToCacheIdx[e]=s,console.log(this._prefixLog,` use cacheIdx : ${s}  => alloc item : ${e}`),r?r.then(()=>void 0!==this._itemIdxToCacheIdx[e]?this.alloc(e):null):this.alloc(e)}unallocStrategie(e){console.assert(!1,"This method must be overriden")}alloc(e){console.assert(!1,"This method must be overriden")}free(e){console.assert(!1,"This method must be overriden")}getAsync(e){return void 0===this._itemIdxToCacheIdx[e]?(console.log(this._prefixLog,"item("+e+") not cached => compute it"),this._cache(e)):(console.log(this._prefixLog,"item("+e+") already in cache => get it"),Promise.resolve(this._items[e]))}get(e){return this.getAsync(e),this._items[e]}push(e){return console.assert(this._items&&this._items.length,"items is not initialysed"),this._items.push(e),this}forEach(e){return this._items.forEach(e),this}map(e){return this._items.map(e)}reduce(e){return this._items.reduce(e)}cache(e){return e="number"==typeof e?new Array(e):e,this._manageSetGet("_cache",e)}items(e){return this._manageSetGet("_items",e)}_manageSetGet(e,t){return t?(this[e]=t,this.init(),this):this[e]}}class r extends s{unallocStrategie(e){return 0}}i.d(t,"Abstract",function(){return h}),i.d(t,"FifoCache",function(){return o}),i.d(t,"SidePrefetch",function(){return n});const h=s,o=r,n=class extends class extends r{getSignedMinDistance(e,t,i,s=!1){let r=t-e;if(s)if(r>0){if(i-r<r)return-(i-r)}else if(i+r<-r)return i+r;return r}prefetchingOff(){this._prefetchingOn=!1}prefetchingOn(){this._prefetchingOn=!0}}{init(){super.init(),this._items||(this._cyclic=this._cyclic||!1,this._nbItems=this._items.length,this._rightPrefetchSize=void 0!==this._rightPrefetchSize?this._rightPrefetchSize:this._leftPrefetchSize,this._sidePrefetchOffOnce=!1,this._prefetchingOn=!0)}unallocStrategie(e){for(let e=0;e<this._history.length;e++){let t=this.getSignedMinDistance(this._curItemIdx,this._history[e].itemIdx,this._nbItems,this._cyclic);if(t>this._rightPrefetchSize||0-t>this._leftPrefetchSize)return e}return super.unallocStrategie(e)}get(e){this._curItemIdx=e,console.group(this._prefixLog,"Get current : ",e),console.log(this._prefixLog,"/////////////////////////////////");let t=super.get(e);if(this._prefetchingOn){for(let t=e-this._leftPrefetchSize;t<=e-1;t++)if(t<0){if(this._cyclic){let e=this.items.length+t;console.log(this._prefixLog,"/////////////////"),console.log(this._prefixLog,"Prefetch left : ",e),super.get(e)}}else console.log(this._prefixLog,"/////////////////"),console.log(this._prefixLog,"Prefetch left : ",t),super.get(t);for(let t=e+1,i=0;i<this._rightPrefetchSize;t++,i++)if(t>=this.items.length){if(this._cyclic){let e=t-this.items.length;console.log(this._prefixLog,"/////////////////"),console.log(this._prefixLog,"Prefetch right :",e),super.get(e)}}else console.log(this._prefixLog,"/////////////////"),console.log(this._prefixLog,"Prefetch right :",t),super.get(t)}return console.groupEnd(),t}prefetchSideSize(e){this._manageSetGet("_leftPrefetchSize",e)}leftPrefetchSideSize(e){this._manageSetGet("_leftPrefetchSize",e)}rightPrefetchSideSize(e){this._manageSetGet("_rightPrefetchSize",e)}}}])});
//# sourceMappingURL=asynca.js.map